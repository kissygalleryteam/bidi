/*! bidi - v1.2 - 2014-01-06 7:21:16 PM
* Copyright (c) 2014 hanwen.sah; Licensed  */
KISSY.add("gallery/bidi/1.2/xtemplate/commands",function(a){var b;return b={each:function(b,c){var d,e=c.params,f=e[0],g="";if(f){var h=[0,0].concat(b);if(a.isArray(f)){d=f.length;for(var i=0;d>i;i++)h[0]=f[i],h[1]={xcount:d,xindex:i},g+=c.fn(h)}else for(var j in f)h[0]=f[j],h[1]={xindex:j},g+=c.fn(h)}else c.inverse&&(g=c.inverse(b));return g},"with":function(a,b){var c=b.params,d=c[0],e=[0].concat(a),f="";return d?(e[0]=d,f=b.fn(e)):b.inverse&&(f=b.inverse(a)),f},"if":function(a,b){var c=b.params,d=c[0],e="";return d?b.fn&&(e=b.fn(a)):b.inverse&&(e=b.inverse(a)),e},set:function(b,c){for(var d=b.length-1;d>=0;d--)if("object"==typeof b[d]){a.mix(b[d],c.hash);break}return""},include:function(b,c){var d=c.params,e=c.hash?[c.hash]:[];if(b=e.concat(b),!d||1!=d.length)return a.error("include must has one param"),"";var f=this.config.name,g=d[0];if("."==g.charAt(0)){if("unspecified"==f)return a.error("parent template does not have name for relative sub tpl name: "+g),"";g=a.Path.resolve(f,"../",g)}var h=this.config.loader.call(this,g);return c=a.merge(this.config),c.name=g,c.commands=this.config.commands,c.macros=this.config.macros,this.invokeEngine(h,b,c)},macro:function(b,c){var d=c.params,e=d[0],f=d.slice(1),g=this.config.macros;if(!c.fn){var h={},i=g[e];i||(i=a.require(e),i||a.error("can not find macro module:"+name)),a.each(i.paramNames,function(a,b){h[a]=f[b]});var j=b.concat();return j.unshift(h),i.fn.call(this,j)}return g[e]||(g[e]={paramNames:f,fn:c.fn}),""},parse:function(a,c){return b.include.call(this,[],c)}}}),KISSY.add("gallery/bidi/1.2/xtemplate/runtime",function(a,b,c){function d(a){i.info(a)}function e(a,b){for(var c=b.split("."),d=a,e=c.length,f=0;e>f&&(d=d[c[f]],d);f++);return d}function f(a,b,c){"."===a&&(a="this"),a=a.split(".");var d,e,f,g,h=a.length,i=c||0,j=b.length;for("root"==a[0]&&(i=j-1,a.shift(),h--);j>i;i++){for(e=b[i],g=1,d=0;h>d;d++)if(f=a[d],"this"!==f){if("object"!=typeof e||!(f in e)){g=0;break}e=e[f]}if(g)return"function"==typeof e&&(e=e.call(b[0])),[e]}return!1}function g(c,d){var e=this;e.tpl=c,d=a.merge(k,d),d.commands=a.merge(d.commands,b),d.utils=j,d.macros=d.macros||{},this.config=d}var h=a.escapeHtml,i=a.getLogger("s/xtemplate"),j={runBlockCommand:function(b,g,h,i,j){var k=b.config,l=k.silent?d:a.error,m=k.commands,n=e(m,i);if(!n){if(h.params||h.hash)return a.error("can not find command module: "+i+"' at line "+j),"";var o=f(i,g);o===!1?(l("can not find property: '"+i+"' at line "+j),o=""):o=o[0],n=m["if"],a.isArray(o)?n=m.each:"object"==typeof o&&(n=m["with"]),h.params=[o]}var p="";try{p=n.call(b,g,h)}catch(q){a.error(q.message+": '"+i+"' at line "+j)}return p===c&&(p=""),p},getExpression:function(a,b){return a===c&&(a=""),b&&a?h(a):a},getPropertyOrRunCommand:function(b,g,i,j,k,l,m,n){var o,p=b.config,q=p.commands,r=e(q,j),s=p.silent?d:a.error;if(r)try{o=r.call(b,g,i)}catch(t){return a.error(t.message+": '"+j+"' at line "+l),""}else{var u=f(j,g,k);if(u===!1)return s("can not find property: '"+j+"' at line "+l,"warn"),n?c:"";o=u[0]}return n||o!==c||(o=""),m&&o?h(o):o}},k={silent:!0,name:"unspecified",loader:function(b){var c=a.require(b);return c||a.error('template "'+b+'" does not exist, '+"need to be required or used first!"),c}};return a.mix(g,{commands:b,utils:j,addCommand:function(a,c){b[a]=c},removeCommand:function(a){delete b[a]}}),g.prototype={constructor:g,invokeEngine:function(a,b,c){return new this.constructor(a,c).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},addCommand:function(a,b){this.config.commands[a]=b},render:function(b,c){return c||(b=[b]),this.tpl(b,a)}},g},{requires:["./commands"]}),KISSY.add("gallery/bidi/1.2/xtemplate/parser",function(){var a={},b=KISSY,c={SHIFT_TYPE:1,REDUCE_TYPE:2,ACCEPT_TYPE:0,TYPE_INDEX:0,PRODUCTION_INDEX:1,TO_INDEX:2},d=function(a){var c=this;c.rules=[],b.mix(c,a),c.resetInput(c.input)};d.prototype={constructor:function(a){var c=this;c.rules=[],b.mix(c,a),c.resetInput(c.input)},resetInput:function(a){b.mix(this,{input:a,matched:"",stateStack:[d.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},getCurrentRules:function(){var a=this,c=a.stateStack[a.stateStack.length-1],e=[];return c=a.mapState(c),b.each(a.rules,function(a){var f=a.state||a[3];f?b.inArray(c,f)&&e.push(a):c==d.STATIC.INITIAL&&e.push(a)}),e},pushState:function(a){this.stateStack.push(a)},popState:function(){return this.stateStack.pop()},getStateStack:function(){return this.stateStack},showDebugInfo:function(){var a=this,b=d.STATIC.DEBUG_CONTEXT_LIMIT,c=a.matched,e=a.match,f=a.input;c=c.slice(0,c.length-e.length);var g=(c.length>b?"...":"")+c.slice(-b).replace(/\n/," "),h=e+f;return h=h.slice(0,b)+(h.length>b?"...":""),g+h+"\n"+new Array(g.length+1).join("-")+"^"},mapSymbol:function(a){var b=this,c=b.symbolMap;return c?c[a]||(c[a]=++b.symbolId):a},mapReverseSymbol:function(a){var b,c=this,d=c.symbolMap,e=c.reverseSymbolMap;if(!e&&d){e=c.reverseSymbolMap={};for(b in d)e[d[b]]=b}return e?e[a]:a},mapState:function(a){var b=this,c=b.stateMap;return c?c[a]||(c[a]=++b.stateId):a},lex:function(){var a,c,e,f,g,h=this,i=h.input,j=h.getCurrentRules();if(h.match=h.text="",!i)return h.mapSymbol(d.STATIC.END_TAG);for(a=0;a<j.length;a++){c=j[a];var k=c.regexp||c[1],l=c.token||c[0],m=c.action||c[2]||void 0;if(e=i.match(k)){g=e[0].match(/\n.*/g),g&&(h.lineNumber+=g.length),b.mix(h,{firstLine:h.lastLine,lastLine:h.lineNumber+1,firstColumn:h.lastColumn,lastColumn:g?g[g.length-1].length-1:h.lastColumn+e[0].length});var n;return n=h.match=e[0],h.matches=e,h.text=n,h.matched+=n,f=m&&m.call(h),f=void 0==f?l:h.mapSymbol(f),i=i.slice(n.length),h.input=i,f?f:h.lex()}}return b.error("lex error at line "+h.lineNumber+":\n"+h.showDebugInfo()),void 0}},d.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};var e=new d({rules:[[0,/^[\s\S]*?(?={{)/,function(){var a,b=this,c=b.text,d=0;return(a=c.match(/\\+$/))&&(d=a[0].length),d%2?b.pushState("et"):b.pushState("t"),d&&(c=c.slice(0,-1)),b.text=c,"CONTENT"}],[2,/^[\s\S]+/,0],[2,/^[\s\S]{2,}?(?:(?={{)|$)/,function(){this.popState()},["et"]],[3,/^{{(?:#|@|\^)/,0,["t"]],[4,/^{{\//,0,["t"]],[5,/^{{\s*else\s*}}/,function(){this.popState()},["t"]],[0,/^{{![\s\S]*?}}/,function(){this.popState()},["t"]],[2,/^{{%([\s\S]*?)%}}/,function(){this.text=this.matches[1]||"",this.popState()},["t"]],[6,/^{{{?/,0,["t"]],[0,/^\s+/,0,["t"]],[7,/^}}}?/,function(){this.popState()},["t"]],[8,/^\(/,0,["t"]],[9,/^\)/,0,["t"]],[10,/^\|\|/,0,["t"]],[11,/^&&/,0,["t"]],[12,/^===/,0,["t"]],[13,/^!==/,0,["t"]],[15,/^>=/,0,["t"]],[17,/^<=/,0,["t"]],[14,/^>/,0,["t"]],[16,/^</,0,["t"]],[18,/^\+/,0,["t"]],[19,/^-/,0,["t"]],[20,/^\*/,0,["t"]],[21,/^\//,0,["t"]],[22,/^%/,0,["t"]],[23,/^!/,0,["t"]],[24,/^"(\\[\s\S]|[^"])*"/,function(){this.text=this.text.slice(1,-1).replace(/\\"/g,'"')},["t"]],[24,/^'(\\[\s\S]|[^'])*'/,function(){this.text=this.text.slice(1,-1).replace(/\\'/g,"'")},["t"]],[25,/^true/,0,["t"]],[25,/^false/,0,["t"]],[26,/^\d+(?:\.\d+)?(?:e-?\d+)?/i,0,["t"]],[27,/^=/,0,["t"]],[28,/^\.(?=})/,0,["t"]],[28,/^\.\./,function(){this.pushState("ws")},["t"]],[29,/^\//,function(){this.popState()},["ws"]],[29,/^\./,0,["t"]],[30,/^\[/,0,["t"]],[31,/^\]/,0,["t"]],[28,/^[a-zA-Z0-9_$]+/,0,["t"]],[32,/^./,0,["t"]]]});return a.lexer=e,e.symbolMap={$EOF:1,CONTENT:2,OPEN_BLOCK:3,OPEN_CLOSE_BLOCK:4,INVERSE:5,OPEN_TPL:6,CLOSE:7,LPAREN:8,RPAREN:9,OR:10,AND:11,LOGIC_EQUALS:12,LOGIC_NOT_EQUALS:13,GT:14,GE:15,LT:16,LE:17,PLUS:18,MINUS:19,MULTIPLY:20,DIVIDE:21,MODULUS:22,NOT:23,STRING:24,BOOLEAN:25,NUMBER:26,EQUALS:27,ID:28,SEP:29,REF_START:30,REF_END:31,INVALID:32,$START:33,program:34,statements:35,statement:36,openBlock:37,closeBlock:38,tpl:39,inBlockTpl:40,path:41,inTpl:42,Expression:43,params:44,hash:45,param:46,ConditionalOrExpression:47,ConditionalAndExpression:48,EqualityExpression:49,RelationalExpression:50,AdditiveExpression:51,MultiplicativeExpression:52,UnaryExpression:53,PrimaryExpression:54,hashSegments:55,hashSegment:56,pathSegments:57},a.productions=[[33,[34]],[34,[35,5,35],function(){return new this.yy.ProgramNode(this.lexer.lineNumber,this.$1,this.$3)}],[34,[35],function(){return new this.yy.ProgramNode(this.lexer.lineNumber,this.$1)}],[35,[36],function(){return[this.$1]}],[35,[35,36],function(){this.$1.push(this.$2)}],[36,[37,34,38],function(){return new this.yy.BlockNode(this.lexer.lineNumber,this.$1,this.$2,this.$3)}],[36,[39]],[36,[2],function(){return new this.yy.ContentNode(this.lexer.lineNumber,this.$1)}],[40,[41],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1)}],[40,[42]],[37,[3,40,7],function(){return"^"==this.$1.charAt(this.$1.length-1)&&(this.$2.isInverted=1),this.$2}],[38,[4,41,7],function(){return this.$2}],[39,[6,42,7],function(){return 3===this.$1.length&&(this.$2.escaped=!1),this.$2}],[39,[6,43,7],function(){var a=new this.yy.TplExpressionNode(this.lexer.lineNumber,this.$2);return 3===this.$1.length&&(a.escaped=!1),a}],[42,[41,44,45],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,this.$2,this.$3)}],[42,[41,44],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,this.$2)}],[42,[41,45],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,null,this.$2)}],[44,[44,46],function(){this.$1.push(this.$2)}],[44,[46],function(){return[this.$1]}],[46,[43]],[43,[47]],[47,[48]],[47,[47,10,48],function(){return new this.yy.ConditionalOrExpression(this.$1,this.$3)}],[48,[49]],[48,[48,11,49],function(){return new this.yy.ConditionalAndExpression(this.$1,this.$3)}],[49,[50]],[49,[49,12,50],function(){return new this.yy.EqualityExpression(this.$1,"===",this.$3)}],[49,[49,13,50],function(){return new this.yy.EqualityExpression(this.$1,"!==",this.$3)}],[50,[51]],[50,[50,16,51],function(){return new this.yy.RelationalExpression(this.$1,"<",this.$3)}],[50,[50,14,51],function(){return new this.yy.RelationalExpression(this.$1,">",this.$3)}],[50,[50,17,51],function(){return new this.yy.RelationalExpression(this.$1,"<=",this.$3)}],[50,[50,15,51],function(){return new this.yy.RelationalExpression(this.$1,">=",this.$3)}],[51,[52]],[51,[51,18,52],function(){return new this.yy.AdditiveExpression(this.$1,"+",this.$3)}],[51,[51,19,52],function(){return new this.yy.AdditiveExpression(this.$1,"-",this.$3)}],[52,[53]],[52,[52,20,53],function(){return new this.yy.MultiplicativeExpression(this.$1,"*",this.$3)}],[52,[52,21,53],function(){return new this.yy.MultiplicativeExpression(this.$1,"/",this.$3)}],[52,[52,22,53],function(){return new this.yy.MultiplicativeExpression(this.$1,"%",this.$3)}],[53,[23,53],function(){return new this.yy.UnaryExpression(this.$1)}],[53,[54]],[54,[24],function(){return new this.yy.StringNode(this.lexer.lineNumber,this.$1)}],[54,[26],function(){return new this.yy.NumberNode(this.lexer.lineNumber,this.$1)}],[54,[25],function(){return new this.yy.BooleanNode(this.lexer.lineNumber,this.$1)}],[54,[41]],[54,[8,43,9],function(){return this.$2}],[45,[55],function(){return new this.yy.HashNode(this.lexer.lineNumber,this.$1)}],[55,[55,56],function(){this.$1.push(this.$2)}],[55,[56],function(){return[this.$1]}],[56,[28,27,43],function(){return[this.$1,this.$3]}],[41,[57],function(){return new this.yy.IdNode(this.lexer.lineNumber,this.$1)}],[57,[57,29,28],function(){this.$1.push(this.$3)}],[57,[57,30,43,31],function(){this.$1.push(this.$3)}],[57,[57,29,26],function(){this.$1.push(this.$3)}],[57,[28],function(){return[this.$1]}]],a.table={gotos:{0:{34:4,35:5,36:6,37:7,39:8},2:{40:10,41:11,42:12,57:13},3:{41:19,42:20,43:21,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,57:13},5:{36:31,37:7,39:8},7:{34:32,35:5,36:6,37:7,39:8},11:{41:35,43:36,44:37,45:38,46:39,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,55:40,56:41,57:13},14:{41:35,43:44,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,57:13},15:{41:35,53:45,54:29,57:13},19:{41:35,43:36,44:37,45:38,46:39,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,55:40,56:41,57:13},30:{35:61,36:6,37:7,39:8},32:{38:63},37:{41:35,43:36,45:65,46:66,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,55:40,56:41,57:13},40:{56:68},43:{41:35,43:71,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,57:13},48:{41:35,48:73,49:24,50:25,51:26,52:27,53:28,54:29,57:13},49:{41:35,49:74,50:25,51:26,52:27,53:28,54:29,57:13},50:{41:35,50:75,51:26,52:27,53:28,54:29,57:13},51:{41:35,50:76,51:26,52:27,53:28,54:29,57:13},52:{41:35,51:77,52:27,53:28,54:29,57:13},53:{41:35,51:78,52:27,53:28,54:29,57:13},54:{41:35,51:79,52:27,53:28,54:29,57:13},55:{41:35,51:80,52:27,53:28,54:29,57:13},56:{41:35,52:81,53:28,54:29,57:13},57:{41:35,52:82,53:28,54:29,57:13},58:{41:35,53:83,54:29,57:13},59:{41:35,53:84,54:29,57:13},60:{41:35,53:85,54:29,57:13},61:{36:31,37:7,39:8},62:{41:86,57:13},64:{41:35,43:87,47:22,48:23,49:24,50:25,51:26,52:27,53:28,54:29,57:13}},action:{0:{2:[1,void 0,1],3:[1,void 0,2],6:[1,void 0,3]},1:{1:[2,7],2:[2,7],3:[2,7],4:[2,7],5:[2,7],6:[2,7]},2:{28:[1,void 0,9]},3:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},4:{1:[0]},5:{1:[2,2],2:[1,void 0,1],3:[1,void 0,2],4:[2,2],5:[1,void 0,30],6:[1,void 0,3]},6:{1:[2,3],2:[2,3],3:[2,3],4:[2,3],5:[2,3],6:[2,3]},7:{2:[1,void 0,1],3:[1,void 0,2],6:[1,void 0,3]},8:{1:[2,6],2:[2,6],3:[2,6],4:[2,6],5:[2,6],6:[2,6]},9:{7:[2,55],8:[2,55],9:[2,55],10:[2,55],11:[2,55],12:[2,55],13:[2,55],14:[2,55],15:[2,55],16:[2,55],17:[2,55],18:[2,55],19:[2,55],20:[2,55],21:[2,55],22:[2,55],23:[2,55],24:[2,55],25:[2,55],26:[2,55],28:[2,55],29:[2,55],30:[2,55],31:[2,55]},10:{7:[1,void 0,33]},11:{7:[2,8],8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,34]},12:{7:[2,9]},13:{7:[2,51],8:[2,51],9:[2,51],10:[2,51],11:[2,51],12:[2,51],13:[2,51],14:[2,51],15:[2,51],16:[2,51],17:[2,51],18:[2,51],19:[2,51],20:[2,51],21:[2,51],22:[2,51],23:[2,51],24:[2,51],25:[2,51],26:[2,51],28:[2,51],29:[1,void 0,42],30:[1,void 0,43],31:[2,51]},14:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},15:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},16:{7:[2,42],8:[2,42],9:[2,42],10:[2,42],11:[2,42],12:[2,42],13:[2,42],14:[2,42],15:[2,42],16:[2,42],17:[2,42],18:[2,42],19:[2,42],20:[2,42],21:[2,42],22:[2,42],23:[2,42],24:[2,42],25:[2,42],26:[2,42],28:[2,42],31:[2,42]},17:{7:[2,44],8:[2,44],9:[2,44],10:[2,44],11:[2,44],12:[2,44],13:[2,44],14:[2,44],15:[2,44],16:[2,44],17:[2,44],18:[2,44],19:[2,44],20:[2,44],21:[2,44],22:[2,44],23:[2,44],24:[2,44],25:[2,44],26:[2,44],28:[2,44],31:[2,44]},18:{7:[2,43],8:[2,43],9:[2,43],10:[2,43],11:[2,43],12:[2,43],13:[2,43],14:[2,43],15:[2,43],16:[2,43],17:[2,43],18:[2,43],19:[2,43],20:[2,43],21:[2,43],22:[2,43],23:[2,43],24:[2,43],25:[2,43],26:[2,43],28:[2,43],31:[2,43]},19:{7:[2,45],8:[1,void 0,14],10:[2,45],11:[2,45],12:[2,45],13:[2,45],14:[2,45],15:[2,45],16:[2,45],17:[2,45],18:[2,45],19:[2,45],20:[2,45],21:[2,45],22:[2,45],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,34]},20:{7:[1,void 0,46]},21:{7:[1,void 0,47]},22:{7:[2,20],8:[2,20],9:[2,20],10:[1,void 0,48],23:[2,20],24:[2,20],25:[2,20],26:[2,20],28:[2,20],31:[2,20]},23:{7:[2,21],8:[2,21],9:[2,21],10:[2,21],11:[1,void 0,49],23:[2,21],24:[2,21],25:[2,21],26:[2,21],28:[2,21],31:[2,21]},24:{7:[2,23],8:[2,23],9:[2,23],10:[2,23],11:[2,23],12:[1,void 0,50],13:[1,void 0,51],23:[2,23],24:[2,23],25:[2,23],26:[2,23],28:[2,23],31:[2,23]},25:{7:[2,25],8:[2,25],9:[2,25],10:[2,25],11:[2,25],12:[2,25],13:[2,25],14:[1,void 0,52],15:[1,void 0,53],16:[1,void 0,54],17:[1,void 0,55],23:[2,25],24:[2,25],25:[2,25],26:[2,25],28:[2,25],31:[2,25]},26:{7:[2,28],8:[2,28],9:[2,28],10:[2,28],11:[2,28],12:[2,28],13:[2,28],14:[2,28],15:[2,28],16:[2,28],17:[2,28],18:[1,void 0,56],19:[1,void 0,57],23:[2,28],24:[2,28],25:[2,28],26:[2,28],28:[2,28],31:[2,28]},27:{7:[2,33],8:[2,33],9:[2,33],10:[2,33],11:[2,33],12:[2,33],13:[2,33],14:[2,33],15:[2,33],16:[2,33],17:[2,33],18:[2,33],19:[2,33],20:[1,void 0,58],21:[1,void 0,59],22:[1,void 0,60],23:[2,33],24:[2,33],25:[2,33],26:[2,33],28:[2,33],31:[2,33]},28:{7:[2,36],8:[2,36],9:[2,36],10:[2,36],11:[2,36],12:[2,36],13:[2,36],14:[2,36],15:[2,36],16:[2,36],17:[2,36],18:[2,36],19:[2,36],20:[2,36],21:[2,36],22:[2,36],23:[2,36],24:[2,36],25:[2,36],26:[2,36],28:[2,36],31:[2,36]},29:{7:[2,41],8:[2,41],9:[2,41],10:[2,41],11:[2,41],12:[2,41],13:[2,41],14:[2,41],15:[2,41],16:[2,41],17:[2,41],18:[2,41],19:[2,41],20:[2,41],21:[2,41],22:[2,41],23:[2,41],24:[2,41],25:[2,41],26:[2,41],28:[2,41],31:[2,41]},30:{2:[1,void 0,1],3:[1,void 0,2],6:[1,void 0,3]},31:{1:[2,4],2:[2,4],3:[2,4],4:[2,4],5:[2,4],6:[2,4]},32:{4:[1,void 0,62]},33:{2:[2,10],3:[2,10],6:[2,10]},34:{7:[2,55],8:[2,55],10:[2,55],11:[2,55],12:[2,55],13:[2,55],14:[2,55],15:[2,55],16:[2,55],17:[2,55],18:[2,55],19:[2,55],20:[2,55],21:[2,55],22:[2,55],23:[2,55],24:[2,55],25:[2,55],26:[2,55],27:[1,void 0,64],28:[2,55],29:[2,55],30:[2,55]},35:{7:[2,45],8:[2,45],9:[2,45],10:[2,45],11:[2,45],12:[2,45],13:[2,45],14:[2,45],15:[2,45],16:[2,45],17:[2,45],18:[2,45],19:[2,45],20:[2,45],21:[2,45],22:[2,45],23:[2,45],24:[2,45],25:[2,45],26:[2,45],28:[2,45],31:[2,45]},36:{7:[2,19],8:[2,19],23:[2,19],24:[2,19],25:[2,19],26:[2,19],28:[2,19]},37:{7:[2,15],8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,34]},38:{7:[2,16]},39:{7:[2,18],8:[2,18],23:[2,18],24:[2,18],25:[2,18],26:[2,18],28:[2,18]},40:{7:[2,47],28:[1,void 0,67]},41:{7:[2,49],28:[2,49]},42:{26:[1,void 0,69],28:[1,void 0,70]},43:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},44:{9:[1,void 0,72]},45:{7:[2,40],8:[2,40],9:[2,40],10:[2,40],11:[2,40],12:[2,40],13:[2,40],14:[2,40],15:[2,40],16:[2,40],17:[2,40],18:[2,40],19:[2,40],20:[2,40],21:[2,40],22:[2,40],23:[2,40],24:[2,40],25:[2,40],26:[2,40],28:[2,40],31:[2,40]},46:{1:[2,12],2:[2,12],3:[2,12],4:[2,12],5:[2,12],6:[2,12]},47:{1:[2,13],2:[2,13],3:[2,13],4:[2,13],5:[2,13],6:[2,13]},48:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},49:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},50:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},51:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},52:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},53:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},54:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},55:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},56:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},57:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},58:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},59:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},60:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},61:{1:[2,1],2:[1,void 0,1],3:[1,void 0,2],4:[2,1],6:[1,void 0,3]},62:{28:[1,void 0,9]},63:{1:[2,5],2:[2,5],3:[2,5],4:[2,5],5:[2,5],6:[2,5]},64:{8:[1,void 0,14],23:[1,void 0,15],24:[1,void 0,16],25:[1,void 0,17],26:[1,void 0,18],28:[1,void 0,9]},65:{7:[2,14]},66:{7:[2,17],8:[2,17],23:[2,17],24:[2,17],25:[2,17],26:[2,17],28:[2,17]},67:{27:[1,void 0,64]},68:{7:[2,48],28:[2,48]},69:{7:[2,54],8:[2,54],9:[2,54],10:[2,54],11:[2,54],12:[2,54],13:[2,54],14:[2,54],15:[2,54],16:[2,54],17:[2,54],18:[2,54],19:[2,54],20:[2,54],21:[2,54],22:[2,54],23:[2,54],24:[2,54],25:[2,54],26:[2,54],28:[2,54],29:[2,54],30:[2,54],31:[2,54]},70:{7:[2,52],8:[2,52],9:[2,52],10:[2,52],11:[2,52],12:[2,52],13:[2,52],14:[2,52],15:[2,52],16:[2,52],17:[2,52],18:[2,52],19:[2,52],20:[2,52],21:[2,52],22:[2,52],23:[2,52],24:[2,52],25:[2,52],26:[2,52],28:[2,52],29:[2,52],30:[2,52],31:[2,52]},71:{31:[1,void 0,88]},72:{7:[2,46],8:[2,46],9:[2,46],10:[2,46],11:[2,46],12:[2,46],13:[2,46],14:[2,46],15:[2,46],16:[2,46],17:[2,46],18:[2,46],19:[2,46],20:[2,46],21:[2,46],22:[2,46],23:[2,46],24:[2,46],25:[2,46],26:[2,46],28:[2,46],31:[2,46]},73:{7:[2,22],8:[2,22],9:[2,22],10:[2,22],11:[1,void 0,49],23:[2,22],24:[2,22],25:[2,22],26:[2,22],28:[2,22],31:[2,22]},74:{7:[2,24],8:[2,24],9:[2,24],10:[2,24],11:[2,24],12:[1,void 0,50],13:[1,void 0,51],23:[2,24],24:[2,24],25:[2,24],26:[2,24],28:[2,24],31:[2,24]},75:{7:[2,26],8:[2,26],9:[2,26],10:[2,26],11:[2,26],12:[2,26],13:[2,26],14:[1,void 0,52],15:[1,void 0,53],16:[1,void 0,54],17:[1,void 0,55],23:[2,26],24:[2,26],25:[2,26],26:[2,26],28:[2,26],31:[2,26]},76:{7:[2,27],8:[2,27],9:[2,27],10:[2,27],11:[2,27],12:[2,27],13:[2,27],14:[1,void 0,52],15:[1,void 0,53],16:[1,void 0,54],17:[1,void 0,55],23:[2,27],24:[2,27],25:[2,27],26:[2,27],28:[2,27],31:[2,27]},77:{7:[2,30],8:[2,30],9:[2,30],10:[2,30],11:[2,30],12:[2,30],13:[2,30],14:[2,30],15:[2,30],16:[2,30],17:[2,30],18:[1,void 0,56],19:[1,void 0,57],23:[2,30],24:[2,30],25:[2,30],26:[2,30],28:[2,30],31:[2,30]},78:{7:[2,32],8:[2,32],9:[2,32],10:[2,32],11:[2,32],12:[2,32],13:[2,32],14:[2,32],15:[2,32],16:[2,32],17:[2,32],18:[1,void 0,56],19:[1,void 0,57],23:[2,32],24:[2,32],25:[2,32],26:[2,32],28:[2,32],31:[2,32]},79:{7:[2,29],8:[2,29],9:[2,29],10:[2,29],11:[2,29],12:[2,29],13:[2,29],14:[2,29],15:[2,29],16:[2,29],17:[2,29],18:[1,void 0,56],19:[1,void 0,57],23:[2,29],24:[2,29],25:[2,29],26:[2,29],28:[2,29],31:[2,29]},80:{7:[2,31],8:[2,31],9:[2,31],10:[2,31],11:[2,31],12:[2,31],13:[2,31],14:[2,31],15:[2,31],16:[2,31],17:[2,31],18:[1,void 0,56],19:[1,void 0,57],23:[2,31],24:[2,31],25:[2,31],26:[2,31],28:[2,31],31:[2,31]},81:{7:[2,34],8:[2,34],9:[2,34],10:[2,34],11:[2,34],12:[2,34],13:[2,34],14:[2,34],15:[2,34],16:[2,34],17:[2,34],18:[2,34],19:[2,34],20:[1,void 0,58],21:[1,void 0,59],22:[1,void 0,60],23:[2,34],24:[2,34],25:[2,34],26:[2,34],28:[2,34],31:[2,34]},82:{7:[2,35],8:[2,35],9:[2,35],10:[2,35],11:[2,35],12:[2,35],13:[2,35],14:[2,35],15:[2,35],16:[2,35],17:[2,35],18:[2,35],19:[2,35],20:[1,void 0,58],21:[1,void 0,59],22:[1,void 0,60],23:[2,35],24:[2,35],25:[2,35],26:[2,35],28:[2,35],31:[2,35]},83:{7:[2,37],8:[2,37],9:[2,37],10:[2,37],11:[2,37],12:[2,37],13:[2,37],14:[2,37],15:[2,37],16:[2,37],17:[2,37],18:[2,37],19:[2,37],20:[2,37],21:[2,37],22:[2,37],23:[2,37],24:[2,37],25:[2,37],26:[2,37],28:[2,37],31:[2,37]},84:{7:[2,38],8:[2,38],9:[2,38],10:[2,38],11:[2,38],12:[2,38],13:[2,38],14:[2,38],15:[2,38],16:[2,38],17:[2,38],18:[2,38],19:[2,38],20:[2,38],21:[2,38],22:[2,38],23:[2,38],24:[2,38],25:[2,38],26:[2,38],28:[2,38],31:[2,38]},85:{7:[2,39],8:[2,39],9:[2,39],10:[2,39],11:[2,39],12:[2,39],13:[2,39],14:[2,39],15:[2,39],16:[2,39],17:[2,39],18:[2,39],19:[2,39],20:[2,39],21:[2,39],22:[2,39],23:[2,39],24:[2,39],25:[2,39],26:[2,39],28:[2,39],31:[2,39]},86:{7:[1,void 0,89]},87:{7:[2,50],28:[2,50]},88:{7:[2,53],8:[2,53],9:[2,53],10:[2,53],11:[2,53],12:[2,53],13:[2,53],14:[2,53],15:[2,53],16:[2,53],17:[2,53],18:[2,53],19:[2,53],20:[2,53],21:[2,53],22:[2,53],23:[2,53],24:[2,53],25:[2,53],26:[2,53],28:[2,53],29:[2,53],30:[2,53],31:[2,53]},89:{1:[2,11],2:[2,11],3:[2,11],4:[2,11],5:[2,11],6:[2,11]}}},a.parse=function(a){var d,e,f,g=this,h=g.lexer,i=g.table,j=i.gotos,k=i.action,l=g.productions,m=[null],n=[0];for(h.resetInput(a);;){if(d=n[n.length-1],e||(e=h.lex()),!e)return b.log("it is not a valid input: "+a,"error"),!1;if(f=k[d]&&k[d][e],!f){var o,p=[];return k[d]&&b.each(k[d],function(a,b){p.push(g.lexer.mapReverseSymbol(b))}),o="Syntax error at line "+h.lineNumber+":\n"+h.showDebugInfo()+"\n"+"expect "+p.join(", "),b.error(o),!1}switch(f[c.TYPE_INDEX]){case c.SHIFT_TYPE:n.push(e),m.push(h.text),n.push(f[c.TO_INDEX]),e=null;break;case c.REDUCE_TYPE:var q=l[f[c.PRODUCTION_INDEX]],r=q.symbol||q[0],s=q.action||q[2],t=q.rhs||q[1],u=t.length,v=0,w=void 0,x=m[m.length-u];for(g.$$=x;u>v;v++)g["$"+(u-v)]=m[m.length-1-v];s&&(w=s.call(g)),x=void 0!==w?w:g.$$,u&&(n=n.slice(0,2*-1*u),m=m.slice(0,-1*u)),n.push(r),m.push(x);var y=j[n[n.length-2]][n[n.length-1]];n.push(y);break;case c.ACCEPT_TYPE:return x}}return void 0},a}),KISSY.add("gallery/bidi/1.2/xtemplate/ast",function(a){var b={};return b.ProgramNode=function(a,b,c){var d=this;d.lineNumber=a,d.statements=b,d.inverse=c},b.ProgramNode.prototype.type="program",b.BlockNode=function(b,c,d,e){var f,g=e.parts,h=this;a.equals(c.path.parts,g)||(f="Syntax error at line "+b+":\n"+"expect {{/"+c.path.parts+"}} not {{/"+g+"}}",a.error(f)),h.lineNumber=b,h.tpl=c,h.program=d},b.BlockNode.prototype.type="block",b.TplNode=function(a,b,c,d){var e=this;e.lineNumber=a,e.path=b,e.params=c,e.hash=d,e.escaped=!0,e.isInverted=!1},b.TplNode.prototype.type="tpl",b.TplExpressionNode=function(a,b){var c=this;c.lineNumber=a,c.expression=b,c.escaped=!0},b.TplExpressionNode.prototype.type="tplExpression",b.ContentNode=function(a,b){var c=this;c.lineNumber=a,c.value=b},b.ContentNode.prototype.type="content",b.UnaryExpression=function(a){this.value=a},b.UnaryExpression.prototype.type="unaryExpression",b.MultiplicativeExpression=function(a,b,c){var d=this;d.op1=a,d.opType=b,d.op2=c},b.MultiplicativeExpression.prototype.type="multiplicativeExpression",b.AdditiveExpression=function(a,b,c){var d=this;d.op1=a,d.opType=b,d.op2=c},b.AdditiveExpression.prototype.type="additiveExpression",b.RelationalExpression=function(a,b,c){var d=this;d.op1=a,d.opType=b,d.op2=c},b.RelationalExpression.prototype.type="relationalExpression",b.EqualityExpression=function(a,b,c){var d=this;d.op1=a,d.opType=b,d.op2=c},b.EqualityExpression.prototype.type="equalityExpression",b.ConditionalAndExpression=function(a,b){var c=this;c.op1=a,c.op2=b},b.ConditionalAndExpression.prototype.type="conditionalAndExpression",b.ConditionalOrExpression=function(a,b){var c=this;c.op1=a,c.op2=b},b.ConditionalOrExpression.prototype.type="conditionalOrExpression",b.StringNode=function(a,b){var c=this;c.lineNumber=a,c.value=b},b.StringNode.prototype.type="string",b.NumberNode=function(a,b){var c=this;c.lineNumber=a,c.value=b},b.NumberNode.prototype.type="number",b.BooleanNode=function(a,b){var c=this;c.lineNumber=a,c.value=b},b.BooleanNode.prototype.type="boolean",b.HashNode=function(b,c){var d=this,e={};d.lineNumber=b,a.each(c,function(a){e[a[0]]=a[1]}),d.value=e},b.HashNode.prototype.type="hash",b.IdNode=function(b,c){var d=this,e=[],f=0;d.lineNumber=b,a.each(c,function(a){".."==a?f++:e.push(a)}),d.parts=e,d.string=e.join("."),d.depth=f},b.IdNode.prototype.type="id",b}),KISSY.add("gallery/bidi/1.2/xtemplate/compiler",function(a,b,c,d,e){function f(a){return a+o++}function g(a,b){return a=b?h(a,!1):a.replace(/\\/g,"\\\\").replace(/'/g,"\\'"),a=a.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")}function h(a,b){return a.replace(b?l:m,function(a){return a.length%2&&(a="\\"+a),a})}function i(a,b){n.apply(a,b)}function j(a){return a[a.length-1]}b.yy=c;var k,l=/\\*"/g,m=/\\*'/g,n=[].push,o=0,p=0,q={genFunction:function(a,b,c){var e=[];if(b||e.push("function(scopes) {"),e.push('var buffer = ""'+(b?",":";")),b){e.push("config = this.config,engine = this, utils = config.utils;");var f,g="",h=d.utils;for(f in h)g+=f+'Util = utils["'+f+'"],';g&&e.push("var "+g.slice(0,g.length-1)+";")}if(a)for(var j=0,k=a.length;k>j;j++)i(e,this[a[j].type](a[j],c));return e.push("return buffer;"),b?{params:["scopes","S","undefined"],source:e,includes:c}:(e.push("}"),e)},genId:function(a,b,c,d){var e=[],g=a.depth,h=a.parts,j=f("id"),k=this;if(0==g){var l,m=b&&k.genConfig(b);m&&(l=m[0],i(e,m[1]))}var n=k.getIdStringFromIdParts(e,h);return d&&"include"==n&&d.push(b.params[0].value),e.push("var "+j+" = getPropertyOrRunCommandUtil(engine,scopes,"+(l||"{}")+',"'+n+'",'+g+","+a.lineNumber+","+(b&&b.escaped)+","+c+");"),[j,e]},genOpExpression:function(a,b){var c,d,f=[],g=this[a.op1.type](a.op1),h=this[a.op2.type](a.op2);return c=g[0],d=h[0],c&&d?(i(f,g[1]),i(f,h[1]),f.push(c+b+d),["",f]):c||d?c&&!d?(i(f,g[1]),i(f,h[1].slice(0,-1)),f.push(c+b+"("+j(h[1])+")"),["",f]):!c&&d?(i(f,g[1].slice(0,-1)),i(f,h[1]),f.push("("+j(g[1])+")"+b+d),["",f]):e:(i(f,g[1].slice(0,-1)),i(f,h[1].slice(0,-1)),f.push("("+j(g[1])+")"+b+"("+j(h[1])+")"),["",f])},genConfig:function(b){var c,d,e,g=[],h=this;if(b){if(d=b.params,e=b.hash,(d||e)&&(c=f("config"),g.push("var "+c+" = {};")),d){var k=f("params");g.push("var "+k+" = [];"),a.each(d,function(a){var b=h[a.type](a);b[0]?(i(g,b[1]),g.push(k+".push("+b[0]+");")):(i(g,b[1].slice(0,-1)),g.push(k+".push("+j(b[1])+");"))}),g.push(c+".params="+k+";")}if(e){var l=f("hash");g.push("var "+l+" = {};"),a.each(e.value,function(a,b){var c=h[a.type](a);c[0]?(i(g,c[1]),g.push(l+'["'+b+'"] = '+c[0]+";")):(i(g,c[1].slice(0,-1)),g.push(l+'["'+b+'"] = '+j(c[1])+";"))}),g.push(c+".hash="+l+";")}}return[c,g]},conditionalOrExpression:function(a){return this.genOpExpression(a,"||")},conditionalAndExpression:function(a){return this.genOpExpression(a,"&&")},relationalExpression:function(a){return this.genOpExpression(a,a.opType)},equalityExpression:function(a){return this.genOpExpression(a,a.opType)},additiveExpression:function(a){return this.genOpExpression(a,a.opType)},multiplicativeExpression:function(a){return this.genOpExpression(a,a.opType)},unaryExpression:function(a){var b,c=[],d=this[a.value.type](a.value);return n.apply(c,d[1]),(b=d[0])?c.push(b+"=!"+b+";"):c[c.length-1]="!"+j(c),[b,c]},string:function(a){return["",["'"+g(a.value,!0)+"'"]]},number:function(a){return["",[a.value]]},"boolean":function(a){return["",[a.value]]},id:function(a,b){return this.genId(a,e,!b)},block:function(b){var c,d=b.program,e=[],g=this,h=b.tpl,j=g.genConfig(h),k=j[0],l=h.path,m=l.string;if(i(e,j[1]),k||(k=a.guid("config"),e.push("var "+k+" = {};")),e.push(k+".fn="+g.genFunction(d.statements).join("\n")+";"),d.inverse&&(c=g.genFunction(d.inverse).join("\n"),e.push(k+".inverse="+c+";")),h.isInverted){var n=f("inverse");e.push("var "+n+"="+k+".fn;"),e.push(k+".fn = "+k+".inverse;"),e.push(k+".inverse = "+n+";")}if(!h.hash&&!h.params)for(var o=l.parts,p=0;p<o.length;p++)if("string"!=typeof o[p]){m=g.getIdStringFromIdParts(e,o);break}return e.push("buffer += runBlockCommandUtil(engine, scopes, "+k+", "+'"'+m+'", '+l.lineNumber+");"),e},content:function(a){return["buffer += '"+g(a.value,!1)+"';"]},tpl:function(a,b){var c=[],d=this.genId(a.path,a,e,b);return i(c,d[1]),c.push("buffer += "+d[0]+";"),c},tplExpression:function(a){var b,c=[],d=a.escaped,e=this[a.expression.type](a.expression,1);return e[0]?(i(c,e[1]),b=e[0]):(i(c,e[1].slice(0,-1)),b=j(e[1])),c.push("buffer += getExpressionUtil("+b+","+d+");"),c},getIdStringFromIdParts:function(a,b){var c,d,e,f,g="",h=this,j=!0;for(c=0;c<b.length;c++)d=b[c],e=d.type,j||(g+="."),e?(f=h[e](d),f[0]&&(i(a,f[1]),g+='"+'+f[0]+'+"',j=!0)):(g+=d,j=!1);return g}};return k={parse:function(a){return b.parse(a)},compileToStr:function(a){var b=this.compile(a);return"function("+b.params.join(",")+"){\n"+b.source.join("\n")+"}"},compileToModule:function(a,b){var c=this.compile(a,b),d="";return b&&b.length&&(d+=b.join('","'),d=', {requires:["'+d+'"]}'),"/** Compiled By kissy-xtemplate */\nKISSY.add(function(){ return function("+c.params.join(",")+"){\n"+c.source.join("\n")+"};}"+d+");"},compile:function(a,b){var c=this.parse(a);return o=0,q.genFunction(c.statements,!0,b)},compileToFn:function(a,b){var c=k.compile(a);b=b||{};var d="sourceURL="+(b.name?b.name:"xtemplate"+p++)+".js";return Function.apply(null,[].concat(c.params).concat(c.source.join("\n")+"\n//@ "+d+"\n//# "+d))}}},{requires:["./parser","./ast","./runtime"]}),KISSY.add("gallery/bidi/1.2/xtemplate",function(a,b,c){function d(a,b){var d;return b.cache&&(d=f[a])?d:(d=c.compileToFn(a,b),b.cache&&(f[a]=d),d)}function e(b,c){var f=this;c=a.merge(g,c),"string"==typeof b&&(b=d(b,c)),e.superclass.constructor.call(f,b,c)
}var f=e.cache={},g={cache:!0};return a.extend(e,b,{},{compiler:c,RunTime:b,addCommand:b.addCommand,removeCommand:b.removeCommand}),e},{requires:["./xtemplate/runtime","./xtemplate/compiler"]}),KISSY.add("gallery/bidi/1.2/expression/parse",function(){var a=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,expressions:3,math:4,EOF:5,"var":6,VAR:7,DOT:8,"||":9,"&&":10,">":11,"<":12,"===":13,"==":14,">=":15,"<=":16,"!=":17,"!":18,NUMBER:19,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"VAR",8:"DOT",9:"||",10:"&&",11:">",12:"<",13:"===",14:"==",15:">=",16:"<=",17:"!=",18:"!",19:"NUMBER"},productions_:[0,[3,2],[6,1],[6,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[4,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:this.$={name:f[g],path:[]};break;case 3:this.$={name:f[g-2].name,path:f[g-2].path.concat(f[g])};break;case 4:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 5:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 6:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 7:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 8:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 9:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 10:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 11:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 12:this.$={l:f[g-2],r:f[g],operator:f[g-1]};break;case 13:this.$={l:f[g],operator:"not"};break;case 14:this.$=f[g];break;case 15:this.$=f[g]}},table:[{3:1,4:2,6:4,7:[1,6],18:[1,3],19:[1,5]},{1:[3]},{5:[1,7],9:[1,8],10:[1,9],11:[1,10],12:[1,11],13:[1,12],14:[1,13],15:[1,14],16:[1,15],17:[1,16]},{4:17,6:4,7:[1,6],18:[1,3],19:[1,5]},{5:[2,14],8:[1,18],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],17:[2,14]},{5:[2,15],9:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],14:[2,15],15:[2,15],16:[2,15],17:[2,15]},{5:[2,2],8:[2,2],9:[2,2],10:[2,2],11:[2,2],12:[2,2],13:[2,2],14:[2,2],15:[2,2],16:[2,2],17:[2,2]},{1:[2,1]},{4:19,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:20,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:21,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:22,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:23,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:24,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:25,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:26,6:4,7:[1,6],18:[1,3],19:[1,5]},{4:27,6:4,7:[1,6],18:[1,3],19:[1,5]},{5:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],17:[2,13]},{7:[1,28]},{5:[2,4],9:[2,4],10:[2,4],11:[1,10],12:[1,11],13:[1,12],14:[1,13],15:[1,14],16:[1,15],17:[1,16]},{5:[2,5],9:[2,5],10:[2,5],11:[1,10],12:[1,11],13:[1,12],14:[1,13],15:[1,14],16:[1,15],17:[1,16]},{5:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[2,6],17:[2,6]},{5:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[2,7],17:[2,7]},{5:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[2,8],17:[2,8]},{5:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[2,9],17:[2,9]},{5:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[2,10],17:[2,10]},{5:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],17:[2,11]},{5:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],17:[2,12]},{5:[2,3],8:[2,3],9:[2,3],10:[2,3],11:[2,3],12:[2,3],13:[2,3],14:[2,3],15:[2,3],16:[2,3],17:[2,3]}],defaultActions:{7:[2,1]},parseError:function(a,b){if(!b.recoverable)throw new Error(a);this.trace(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||m,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1,n=f.slice.call(arguments,1);this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var o=this.lexer.yylloc;f.push(o);var p=this.lexer.options&&this.lexer.options.ranges;this.parseError="function"==typeof this.yy.parseError?this.yy.parseError:Object.getPrototypeOf(this).parseError;for(var q,r,s,t,u,v,w,x,y,z={};;){if(s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:((null===q||"undefined"==typeof q)&&(q=b()),t=g[s]&&g[s][q]),"undefined"==typeof t||!t.length||!t[0]){var A="";y=[];for(v in g[s])this.terminals_[v]&&v>l&&y.push("'"+this.terminals_[v]+"'");A=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+(this.terminals_[q]||q)+"'":"Parse error on line "+(i+1)+": Unexpected "+(q==m?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(A,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:o,expected:y})}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,o=this.lexer.yylloc,k>0&&k--);break;case 2:if(w=this.productions_[t[1]][1],z.$=e[e.length-w],z._$={first_line:f[f.length-(w||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(w||1)].first_column,last_column:f[f.length-1].last_column},p&&(z._$.range=[f[f.length-(w||1)].range[0],f[f.length-1].range[1]]),u=this.performAction.apply(z,[h,j,i,this.yy,t[1],e,f].concat(n)),"undefined"!=typeof u)return u;w&&(d=d.slice(0,2*-1*w),e=e.slice(0,-1*w),f=f.slice(0,-1*w)),d.push(this.productions_[t[1]][0]),e.push(z.$),f.push(z._$),x=g[d[d.length-2]][d[d.length-1]],d.push(x);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d,e;if(this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0))),d=a[0].match(/(?:\r\n?|\n).*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length},this.yytext+=a[0],this.match+=a[0],this.matches=a,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(a[0].length),this.matched+=a[0],c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack){for(var f in e)this[f]=e[f];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");for(var e=this._currentRules(),f=0;f<e.length;f++)if(c=this._input.match(this.rules[e[f]]),c&&(!b||c[0].length>b[0].length)){if(b=c,d=f,this.options.backtrack_lexer){if(a=this.test_match(c,e[f]),a!==!1)return a;if(this._backtrack){b=!1;continue}return!1}if(!this.options.flex)break}return b?(a=this.test_match(b,e[d]),a!==!1?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){var a=this.conditionStack.length-1;return a>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){return a=this.conditionStack.length-1-Math.abs(a||0),a>=0?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 0:return 19;case 1:return 7;case 2:return 8;case 3:return b.yytext;case 4:return b.yytext;case 5:return b.yytext;case 6:return b.yytext;case 7:return b.yytext;case 8:return b.yytext;case 9:return b.yytext;case 10:return b.yytext;case 11:return b.yytext;case 12:return b.yytext;case 13:break;case 14:return 5}},rules:[/^(?:\d+)/,/^(?:[\$\w]+)/,/^(?:\.(?=[\$\w]))/,/^(?:<=)/,/^(?:>=)/,/^(?:===)/,/^(?:==)/,/^(?:>)/,/^(?:<)/,/^(?:!=)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:!)/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],inclusive:!0}}};return a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();return"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=a,exports.Parser=a.Parser,exports.parse=function(){return a.parse.apply(a,arguments)},exports.main=function(a){a[1]||(console.log("Usage: "+a[0]+" FILE"),process.exit(1));var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),a}),KISSY.add("gallery/bidi/1.2/expression/index",function(a,b){"use strict";function c(a){function c(a){if(a.path.length){var b=a.name+"."+a.path.join(".");return j.get(b,k)}return j.get(a.name,k)}var g,h,i=a("key"),j=a("model"),k=a("parent"),l=k?k.name+":"+k.id+i:i;return l in f?(g=f[l].ast,h=f[l].related):(g=b.parse(i),h=d(g,j,k),f[l]={ast:g,related:h}),{val:e(g,c),related:h}}function d(a,b,c){var e=[];if(a.operator)a.l&&(e=e.concat(d(a.l,b,c))),a.r&&(e=e.concat(d(a.r,b,c)));else if(a.name){var f=a.name;a.path.length&&(f+="."+a.path.join(".")),e=e.concat(b.getRelated(f,c))}return e}function e(b,c){if(!b.operator)return b.name?c(b):parseInt(b);switch(b.operator){case"&&":return e(b.l,c)&&e(b.r,c);case"||":return e(b.l,c)||e(b.r,c);case"not":var d=e(b.l,c);return a.isArray(d)?0===d.length:!d;case"===":return e(b.l,c)===e(b.r,c);case"==":return e(b.l,c)==e(b.r,c);case"!=":return e(b.l,c)!=e(b.r,c);case">=":return e(b.l,c)>=e(b.r,c);case"<=":return e(b.l,c)<=e(b.r,c);case"<":return e(b.l,c)<e(b.r,c);case">":return e(b.l,c)>e(b.r,c)}}"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var f={};return c},{requires:["./parse"]}),KISSY.add("gallery/bidi/1.2/models",function(a,b){"use strict";function c(b,c){function d(){}var e;return c?(a.augment(d,c),e=new d,a.mix(e,b)):e=b,this.attributes=e,this.linkages={},this.lists={},this}return a.augment(c,a.EventTarget,{_isFunc:function(b,c){var d;return d=c?this._getParent(c)[b]:this._getAttr(b),a.isFunction(d)},setLists:function(a){this.lists[a]=!0},get:function(a,b){if(b)return this._getByParent(a,b);var c=this._getAttr(a);return"function"!=typeof c||this.__forbidden_call||(c=c.call(this)),this.__recode&&this.__getter.push(a),c},call:function(b,c,d,e){var f=this._getAttr(b);return a.isFunction(f)?(c=a.isArray(c)?c:[c],d=d||this,e&&c.push(this.get(null,e)),f.apply(d,c)):this},_getLinkage:function(b,c){var d,e;return e=b.split("."),a.each(this.linkages,function(f,g){if(0===b.indexOf(g)){d=g;var h=d.split("."),i=this.item(f),j=h[0];return a.each(h,function(a){return c=c[a],void 0===c?!1:void 0}),e=e.slice(h.length),i&&i[j]?(i=i[j],c=a.filter(c,function(b){return b&&a.indexOf(b.value,i)>-1})):(i||void 0===i)&&(c=void 0),!1}},this),{key:d,value:c,paths:e}},_getAttr:function(b,c){var d=c||this.attributes,e=b.split("."),f=this._getLinkage(b,d);return f.key&&(d=f.value,e=f.paths),e.length>2&&"$item"===e[1]&&(d=this.item(e[0]),e=e.slice(2),!d)?d:(a.each(e,function(a){return d=d&&d[a],void 0===d?!1:void 0}),d)},item:function(b){var c=this.get(b);if(!c)return null;var d=c.defaultValue;c=c.values;var e;return c?(a.some(c,function(a){return a.value==d?(e=a,!0):void 0}),e):e},_getByParent:function(b,c){var d,e=!1;if(b&&0===b.indexOf("$root."))d=this._getAttr(b.slice(6)),e=!0;else{var f=this._getParent(c);d=null!==b?this._getAttr(b,f):f}return a.isFunction(d)&&(e?d=d.call(this,this.get(null,c)):(f.parent=this,d=d.call(f,c))),this.__recode&&this.__getter.push(c.name+":"+c.id),d},_getParent:function(b){if(b.__parent__)return b;var c=b.name,d=this.get(c),e={};return a.some(d,function(a){return a.__parent__.id===b.id?(e=a,!0):void 0},this),e},getRelated:function(a,b){return this._isFunc(a,b)?(this.__recode=!0,this.__getter=[],this.get(a,b),this.__recode=!1,this.__getter.slice()):b?[b.name+":"+b.id]:[a]},toJSON:function(){var b={};return this.__forbidden_call=!0,a.each(this.attributes,function(a,c){this.attributes.hasOwnProperty(c)&&(b[c]=this.get(c))},this),delete this.__forbidden_call,b},change:function(b,c,d){var e="";return e=a.isArray(b)?a.map(b,function(a){return"change:"+a+" add:"+a+" remove:"+a}).join(" "):"change:"+b,this.on(e,c,d),this},set:function(b,c,d){if(!/[<=>!|&]+/.test(b)&&!this.__forbidden_call){if(d)return this._setByParent(b,c,d);var e=b.split("."),f=this.attributes,g=e.length;a.each(e,function(a,b){return a in f&&g-1>b?(f=f[a],void 0):!1});var h=e[g-1];return b in this.lists&&this._addToken(b,c),f[h]=c,this.fire("change:"+e[0],{path:e.slice(1),val:c}),this}},_addToken:function(b,c){a.each(c,function(c){c.__parent__={name:b,id:a.guid("$id")}})},remove:function(b){if(!this.__forbidden_call){b.__parent__&&(b=b.__parent__);var c,d=b.name,e=this.get(d);return a.some(e,function(a,d){return a.__parent__.id===b.id?(c=d,!0):void 0}),e.splice(c,1),this.fire("remove:"+d,{id:b.id,index:c}),this}},add:function(b,c){if(!this.__forbidden_call){b.__parent__={id:a.guid("$id"),name:c};var d=this.get(c);return d.push(b),this.fire("add:"+c,{obj:b}),this}},_setByParent:function(a,b,c){var d=this._getParent(c);d&&(d[a]=b);var e=c.__parent__||c;this.fire("change:"+e.name,{$item:e.id}),this.fire("change:"+e.name+":"+e.id)},evaluation:function(a){return b(a)},setLinkage:function(a,b){return this.linkages[a]=b,this}}),c},{requires:["./expression/index","event"]}),KISSY.add("gallery/bidi/1.2/watch/text",function(){"use strict";function a(a){a.add("text",{init:function(){var b=this.$control,c=b("model");b("key");var d=b("el"),e=c.evaluation(b),f=b("argv"),g=f[0];c.change(e.related,function(){var e=c.evaluation(b).val;g&&g in a.pipe&&(e=a.pipe[g](e)),d.html(e)},this)},beforeReady:function(){var b=this.$control,c=b("model"),d=c.evaluation(b).val||"",e=b("argv"),f=e[0];f&&f in a.pipe&&(d=a.pipe[f](d)),this.$html=" id="+b("id")+">"+d+"<!----",a.noEscape[this.$html]=!0}})}return a}),KISSY.add("gallery/bidi/1.2/watch/class",function(){"use strict";return function(a){a.add("class",function(){function a(){var a=b("el"),e=c.evaluation(b).val?"addClass":"removeClass";a[e](d)}var b=this.$control,c=b("model");b("key");var d=b("argv")[0],e=c.evaluation(b);c.change(e.related,a),a()})}}),KISSY.add("gallery/bidi/1.2/watch/click",function(){"use strict";return function(a){a.add("click",function(){var a=this.$control,b=a("model"),c=a("key"),d=a("selector");a("base").delegate("click",d,function(){b.get(c,a("parent"))})})}}),KISSY.add("gallery/bidi/1.2/watch/select",function(){"use strict";return function(a){a.add("select",function(){var a=this.$control,b=a("model"),c=a("key"),d=a("el"),e=a("parent"),f=b.evaluation(a);d.val(f.val),b.change(f.related,function(){var a=b.get(c,e);d.val(a)}),d.on("change",function(){b.set(c,d.val(),e)})})}},{}),KISSY.add("gallery/bidi/1.2/watch/attr",function(){"use strict";return function(a){a.add("attr",function(){function a(a){var c=b("el"),d=b("argv")[0];c.attr(d,a)}var b=this.$control,c=b("model"),d=b("key"),e=c.evaluation(b);a(e.val),c.change(e.related,function(){a(c.evaluation(b).val),c.fire("render:attr",{key:d,el:b("el")})});var f=b("el");f.on("change",function(){var a=b("argv")[0],e=f.attr(a);c.set(d,e,b("parent"))})})}}),KISSY.add("gallery/bidi/1.2/watch/each",function(a,b){"use strict";function c(a){var b;return"select"==a.getDOMNode().tagName.toLowerCase()?a.val():(a.all("input").each(function(a){a.attr("checked")&&(b=a.val())}),b)}function d(a){a.add("linkage",{init:function(){var a=this.$control,d=a("model"),e=a("key"),f=a("argv")[0],g=a("el"),h=e.split(".");d.change(f,function(){var f=a("fn"),i=new b(f),j={params:[d.get(e)],fn:f},k=a("scopes").slice();k.unshift(d.get(e)),i=i.config.commands.each(k,j),g[0].innerHTML=i,d.set(h[0]+".defaultValue",c(g)),a("view").fire("inited"),d.fire("render:linkage",{key:e,el:g})});var i=c(g);i&&d.set(h[0]+".defaultValue",i)},beforeReady:function(){var a=this.$control,b=a("model"),c=a("key"),d=a("argv")[0];b.setLinkage(c,d)}})}return d},{requires:["../xtemplate"]}),KISSY.add("gallery/bidi/1.2/watch/radio",function(a){"use strict";function b(a){var b;return a.all("input").each(function(a){a.attr("checked")&&(b=a.val())}),b}return function(c){c.add("radio",function(){var c=this.$control,d=c("model"),e=c("key"),f=c("el");f.delegate("change","input",function(b){var c=a.all(b.currentTarget),f=c.val();d.set(e,f)});var g=b(f);g&&d.get(e)!=g&&a.later(function(){d.set(e,g)})})}},{}),KISSY.add("gallery/bidi/1.2/watch/list",function(a,b){"use strict";function c(a){a.add("list",{init:function(){var a=this.$control,b=a("model"),c=a("key");b.on("remove:"+c,function(b){var c=a("el").children(),d=b.index;c.item(d).remove()}),b.on("add:"+c,function(c){var d=a("fn"),e={params:[c.obj],fn:d},f=b.toJSON();f.__name__=a("name");var g=e.fn([c.obj,f]).replace(/^>/,"");a("el").append(g),a("view").fire("inited")}),this._bindChange()},_bindChange:function(){var a=this.$control,c=a("model"),d=a("key");c.change(d,function(d){if(!d.$item){var e=a("fn"),f={params:[d.val],fn:e},g=c.toJSON();g.__name__=a("name");var h=new b(e);h=h.config.commands.each([d.val,g],f),a("el").html(h),a("view").fire("inited")}})},beforeReady:function(){var a=this.$control(),b=a.model;b.setLists(a.key)}})}return c},{requires:["../xtemplate"]}),KISSY.add("gallery/bidi/1.2/watch/with",function(){"use strict";function a(a){a.add("with",{init:function(){var a=this.$control,b=a("model"),c=a("key");b.change(c,function(c){if(!c.$item&&!c.path.length){var d=a("fn"),e={params:[c.val],fn:d},f=b.toJSON();f.__name__=a("name");var g=e.fn([c.val,f]);a("el").html(g),a("view").fire("inited")}})},beforeReady:function(){}})}return a},{requires:["../xtemplate"]}),KISSY.add("gallery/bidi/1.2/watch/action",function(){"use strict";return function(a){a.add("action",function(){var a=this.$control,b=a("model"),c=a("key");a("selector");var d=a("argv"),e=d[0];e&&a("el").on(c,function(c){var d=a("parent");b.call(e,c,null,d)})})}}),KISSY.add("gallery/bidi/1.2/watch/print",function(){"use strict";return function(a){a.add("print",{init:function(){},beforeReady:function(){var a=this.$control,b=a("model"),c=b.evaluation(a).val,d=a("argv")[0];this.$html=c?d||c:""}})}}),KISSY.add("gallery/bidi/1.2/watch/value",function(a){"use strict";function b(b){b.add("value",{init:function(){var b=this.$control();a.mix(this,b),this._render()},beforeReady:function(){var a=this.$control;a("key");var b=a("model"),c=b.evaluation(a).val;c&&(this.$html=" value= "+c+" id="+a("id")+" ")},_render:function(){var a=this.el,b=a.attr("type")||"input";this.model,this.key,"radio"==b?this._bindRadio():this._bindEvent()},_bindRadio:function(){var a=this.el,b=this.model,c=this.base,d=a.attr("name"),e=this.key;c.delegate("click","input",function(c){var f=c.currentTarget;if("radio"==f.type&&f.name==d){var g=a.attr("checked");b.set(e,g)}}),b.change(e,function(){a.attr("checked",b.get(e))});var f=a.attr("checked");f&&b.set(e,f)},_bindEvent:function(){var a=this.el,b=this.model,c=this.key,d=this.$control,e=b.evaluation(d),f=this.parent;a.on("keyup change",function(){var d=a.val();b.set(c,d,f)}),b.change(e.related,function(){var c=b.evaluation(d).val||"";a.val(c)})}})}return b},{}),KISSY.add("gallery/bidi/1.2/watch/index",function(a){"use strict";var b={},c={};c.noEscape={};var d=a.escapeHTML;return a.escapeHTML=function(a){return a in c.noEscape?a:d(a)},c.add=function(c,d){c in b&&a.error(c+" has be add before"),a.isFunction(d)&&(d={init:d}),b[c]=function(b){var c={};a.mix(c,b),this.$control=function(b,d){return b?d?(b in c||(c[b]=d),void 0):c[b]:a.mix(c,{})},this.beforeReady&&this.beforeReady(),this.on("ready",this.init,this)},a.augment(b[c],a.EventTarget,d)},c.get=function(a){return b[a]},c.pipe={},a.each(arguments,function(a,b){b&&a(c)}),c},{requires:["./text","./class","./click","./select","./attr","./each","./radio","./list","./with","./action","./print","./value"]}),KISSY.add("gallery/bidi/1.2/views",function(a,b,c,d){"use strict";function e(a,b,c){this.model=b,this.name=a,this.elements=[],this.html=c}return a.augment(e,a.EventTarget,{setEl:function(b){this.el=b;var d=this.html?this.html:b.all("script").html();return this.template=new c(d),this.template?a.log("get template html from script/xtempalte"):a.error("Get template html form script/xtempalte, got none"),this},render:function(){var b=this.model.toJSON();b.__name__=this.name,a.log("start render xtempalte for bidi-"+this.name);var c=this.template.render(b);return c=c.replace(/>\s+>>><<</g,""),this.el.getDOMNode().innerHTML=c,this.fire("inited"),this},get:function(b){var c;return a.some(this.elements,function(a){return a.key===b?(c=a.el,!0):void 0}),c},getAll:function(b){var c=[];return a.each(this.elements,function(a){a.key===b&&c.push(a.el)}),c},watch:function(b,c,e){var f=b[0],g=b[1],h=d.get(f),i=b.id||"bidi-"+this.name+"-"+a.guid(),j="#"+i,k=b.slice(2),l=" id="+i+" ",m=b.meta;if(h){var n=new h({selector:j,parent:m,id:i,key:g,model:this.model,base:this.el,fn:c,scopes:e,argv:k,name:this.name,view:this}),o=function(){var a=this.el.all(j);n.$control("el",a),n.fire("ready"),this.elements.push({key:g,el:a}),this.detach("inited",o)};this.on("inited",o),l=void 0===n.$html?l:n.$html}else a.log("watcher "+f+" is not defined!");return{id:i,html:l}}}),e},{requires:["event","./xtemplate","./watch/index"]}),KISSY.add("gallery/bidi/1.2/macros",function(){function a(a,c){var d=c.params,e=d[0];if(c.fn){var f=d.slice(1);return b[e]={fn:c.fn,params:d.slice(1)},""}for(var g={},h=b[e],f=h.params,i=1;i<d.length;i++)g[f[i-1]]=d[i];return a.unshift(g),h.fn(a)}var b={};return a}),KISSY.add("gallery/bidi/1.2/index",function(a,b,c,d,e,f,g){function h(a,b,c){"."===a&&(a="this"),a=a.split(".");var d,e,f,g,h=a.length,i=c||0,j=b.length;for("root"==a[0]&&(i=j-1,a.shift(),h--);j>i;i++){for(e=b[i],g=1,d=0;h>d;d++)if(f=a[d],"this"!==f){if("object"!=typeof e||!(f in e)){g=0;break}e=e[f]}if(g)return"function"==typeof e&&(e=e.call(b[0])),[e]}return!1}function i(b,c,d){var e,f,g=b.length-1,i=b[g][m],j=b[0][l],o=k[i];return c.params?(a.log("bidi-"+i+" add watch: "+c.params.join(",")),a.each(c.params,function(d){var g=a.map(d.split(":"),a.trim);if(j&&(g.meta=j),c.fn)if(e)g.id=e,o.watch(g);else{var h=o.watch(g,c.fn,b);e=h.id;var k=g[0];k in n?f=n[k](b,c,g,i,h.html):a.log("watch block command no support "+k)}else if(e)g.id=e,o.watch(g);else{var h=o.watch(g);e=h.id,f=h.html}}),f):h(d,b,{})}delete Object.prototype.watch;var j=b.all,k={},l="__parent__",m="__name__",n={linkage:function(b,c,d,e,f){var g=k[e].model,h=k[e].template.config.commands.each;a.log("linkage start run"),b[0].$$linkage=g.get(d[1]),c.params[0]=b[0].$$linkage;var i=h(b,c);return delete b[0].$$linkage,a.log("linkage start run success")," >>><<<"+f+">"+i},list:function(b,c,d,e,f){k[e].model,b.length-1,c.params[0]=b[0][d[1]];for(var g=c.params[0]||[],h=[0,0].concat(b),i=g.length,j="",m=0;i>m;m++)h[0]=g[m],h[0][l]||(h[0][l]={id:a.guid("$id"),name:d[1]}),h[1]={xcount:i,xindex:m},j+=c.fn(h).replace(/^>/,"");return" >>><<<"+f+">"+j},"with":function(a,b,c,d,e){k[d].model,a.length-1,b.params[0]=a[0][c[1]];var f=b.params[0],g=[f].concat(a),h=b.fn(g).replace(/^>/,"");return" >>><<<"+e+">"+h}},o={},p={active:function(){},xbind:function(b,c,d,g){if(!a.isString(b))throw new Error("Bidi init fail, name must be string");return k[b]=new f(b,new e(c,d),g),a.log("init bidi, add view "+b),k[b]},init:function(b){j(".bidi-viewer").each(function(c){var d=c.attr("data-view");if(!(b&&d.indexOf(b)<0)){var e=k[d].setEl(c);e.template.addCommand("watch",i),a.each(o,function(a,b){e.template.addCommand(b,a)}),e.render()}})},add:function(a,b){g.add(a,b)},pipe:function(a,b){g.pipe[a]=b},registerHelper:this.pipe};return p},{requires:["node","base","./xtemplate","./models","./views","./watch/index","./macros"]});